# 明細書チェックくん 要件定義書

## 1. 目的・背景
- 特許明細書案（Word: .docx）を読み込み、以下を自動チェックするツールを提供する。
  - 誤字脱字・表記ゆれ・句読点や括弧ミス等の日本語機械校正
  - 審査基準・特許法（実施可能要件・サポート要件等）に照らした論理的整合性・記載充足性の検証
  - 用語統一、図面・段落・クレームの参照整合
- 指摘項目を一覧化し、ユーザーがチェックで採否を決め、採用分を反映した「修正版.docx」を生成する。

## 2. 想定ユーザー
- 弁理士・特許実務者、企業知財部門、技術者（明細書ドラフト作成者）

## 3. 入出力
- 入力: .docx（Word明細書案）、任意の参考資料（guidelinesフォルダ内: 審査基準/特許法/事例等のPDF, DOCX, MD, TXT）
- 出力:
  - 指摘レポート（JSON/Markdown）
  - 修正版明細書（.docx）
  - 任意でUI（Streamlit）上のチェックリスト

## 4. 機能要件
1) ドキュメント読込
   - .docx本文抽出、段落・見出し・表・図キャプションのテキスト取得
2) 日本語機械校正（ルール/辞書/統計）
   - 連続句読点、括弧不一致、半角/全角混在、重複助詞、余分な空白の検知
   - 用語の表記ゆれ検出（例: 「ユーザ/ユーザー」「及び/および」）
3) 法・基準適合性チェック（LLM活用）
   - guidelinesフォルダ内の審査基準・特許法等を取り込み、
     - 実施可能要件: 実施形態の具体性、再現可能性、数値範囲の根拠
     - サポート要件: クレーム各要素の記載支持、用語定義、作用効果の整合
     - 明確性: 用語定義不足、曖昧な表現、相互矛盾
   - 条文/章節への参照付きで指摘と是正案を提示
4) 用語統一・整合
   - 自動用語リスト（辞書）生成/読込、全体での用語統一提案
   - 図面参照番号・段落番号・クレーム引用の整合チェック
5) 指摘レビューと反映
   - 指摘一覧（カテゴリ、深刻度、位置、理由、推奨修正）
   - チェックで採否を選択し、採用分のみを反映した修正版.docx生成
6) 設定
   - ON/OFF（LLM使用、用語統一、表記ルール）
   - 閾値（ヒューリスティックの感度）
   - 参照フォルダ（guidelines）

## 5. 非機能要件
- セキュリティ: OpenAI APIキーは.envで安全管理。ファイルはローカル処理、LLM送信時は最小限のコンテキスト。
- 性能: 10〜50ページ程度の明細書を実用時間内（数分）で処理。
- 可用性/保守: guidelinesフォルダの差し替えで基準更新。モジュール分割で拡張容易。
- 監査性: 指摘根拠（条文/出典）をレポートに含める。

## 6. アーキテクチャ（概略）
- `word_io`: .docx入出力、テキスト抽出/置換
- `guidelines_loader`: guidelinesフォルダからPDF/MD/TXT/DOCXのテキスト結合
- `analyzers`: 
  - ルールベース（表記/構文ヒューリスティック）
  - LLMベース（審査基準/特許法適合性、整合性チェック）
- `main`: CLIエントリ、レポート生成、修正適用
- 任意UI: `streamlit_app.py`（チェックボックス適用、ダウンロード）

## 7. データモデル（指摘）
{
  "id": "S-0001",
  "category": "typo|style|support|enablement|clarity|consistency",
  "severity": "low|medium|high",
  "message": "問題点の説明",
  "evidence": "根拠テキスト/条文",
  "location": {"paragraph_index": 12, "start": 5, "end": 18},
  "suggested_fix": "推奨修正案",
  "autofix": true
}

## 8. フォルダ構成（初期）
guidelines/            # 審査基準・特許法等（随時差替え可）
  README.md
docs/
  要件定義書.md
meisai_checker/
  __init__.py
  config.py
  guidelines_loader.py
  word_io.py
  analyzers.py
  main.py
app/
  streamlit_app.py     # 任意UI（後続）

## 9. 外部サービス/設定
- OpenAI API（.env: `OPENAI_API_KEY`, `OPENAI_BASE_URL` 任意）
- モデル例: `gpt-4o-mini`（軽量）、精度重視は `gpt-4.1` 系

## 10. テスト/検証
- ヒューリスティック単体テスト（括弧不一致、連続句読点など）
- スモーク: サンプル明細書でJSONレポート生成→目視確認
- ゴール: 誤検知/漏れ率を定期レビュー、ルール/プロンプト改善

## 11. MVP範囲
- .docx読込/出力、guidelinesテキスト統合
- 主要ヒューリスティックの警告
- LLMによる要件（実施可能/サポート/明確性）一次判定と修正提案
- JSONレポート生成、簡易自動修正の適用（置換ベース）

## 12. ロードマップ（抜粋）
- v0.2: Streamlit UI（チェックボックス適用、ダウンロード）
- v0.3: クレーム-明細書トレーサビリティ、図面参照番号整合
- v0.4: トラック変更風の差分出力、ユーザー辞書学習

